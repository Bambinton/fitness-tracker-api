<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ plan.title }} - Fitness Tracker</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav>
        <a href="/" class="logo">üí™ Fitness Tracker</a>
        <div class="nav-links">
            <a href="/dashboard">üìã –ú–æ–∏ –ø–ª–∞–Ω—ã</a>
            {% if current_user.role == 'admin' %}
            <a href="/admin">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
            {% endif %}
            <div class="user-info">
                <span>üë§ {{ current_user.username }}</span>
                <a href="/logout" class="btn-logout">üö™ –í—ã–π—Ç–∏</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="plan-header">
            <div>
                <h1>{{ plan.title }}</h1>
                <div class="plan-meta">
                    <span class="difficulty-badge {{ plan.difficulty }}">
                        {% if plan.difficulty == 'beginner' %}üü¢ –ù–∞—á–∏–Ω–∞—é—â–∏–π
                        {% elif plan.difficulty == 'intermediate' %}üü° –°—Ä–µ–¥–Ω–∏–π
                        {% elif plan.difficulty == 'advanced' %}üî¥ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π
                        {% else %}‚ö™ –ù–µ —É–∫–∞–∑–∞–Ω–æ{% endif %}
                    </span>
                    <span>üìÖ –°–æ–∑–¥–∞–Ω: {{ plan.created_at.strftime('%d.%m.%Y') }}</span>
                    <span>‚è± {{ plan.duration_weeks }} –Ω–µ–¥–µ–ª—å</span>
                    <span>{% if plan.is_public %}üåç –ü—É–±–ª–∏—á–Ω—ã–π{% else %}üîí –ü—Ä–∏–≤–∞—Ç–Ω—ã–π{% endif %}</span>
                </div>
            </div>
            <div class="plan-actions">
                <a href="/dashboard" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
                <button class="btn btn-danger" onclick="deletePlan()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–ª–∞–Ω</button>
            </div>
        </div>
        
        {% if plan.description %}
        <div class="plan-description">
            <h3>üìù –û–ø–∏—Å–∞–Ω–∏–µ</h3>
            <p>{{ plan.description }}</p>
        </div>
        {% endif %}
        
        <div class="exercises-section">
            <div class="section-header">
                <h2>üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h2>
                <button class="btn btn-primary" onclick="showAddExerciseModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
            </div>
            
            {% if exercises %}
            <div class="exercises-list">
                {% for exercise in exercises %}
                <div class="exercise-card">
                    <div class="exercise-header">
                        <h3>{{ exercise.name }}</h3>
                        <span class="exercise-order">#{{ exercise.order }}</span>
                    </div>
                    
                    {% if exercise.description %}
                    <p class="exercise-description">{{ exercise.description }}</p>
                    {% endif %}
                    
                    <div class="exercise-details">
                        {% if exercise.sets %}<span>üî¢ –ü–æ–¥—Ö–æ–¥–æ–≤: {{ exercise.sets }}</span>{% endif %}
                        {% if exercise.reps %}<span>üîÑ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π: {{ exercise.reps }}</span>{% endif %}
                        {% if exercise.rest_seconds %}<span>‚è∏Ô∏è –û—Ç–¥—ã—Ö: {{ exercise.rest_seconds }} —Å–µ–∫</span>{% endif %}
                    </div>
                    
                    <!-- –û–°–¢–ê–í–õ–Ø–ï–ú —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –∫–Ω–æ–ø–∫–∏ -->
                    <div class="exercise-actions">
                        <button class="btn btn-sm btn-danger" onclick="deleteExercise({{ exercise.id }})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <p>–í —ç—Ç–æ–º –ø–ª–∞–Ω–µ –µ—â–µ –Ω–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p>
                <button class="btn btn-primary" onclick="showAddExerciseModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
    <div id="addExerciseModal" class="modal">
        <div class="modal-content">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
            <form id="addExerciseForm">
                <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è" required>
                <textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
                <div class="form-row">
                    <input type="number" name="sets" placeholder="–ü–æ–¥—Ö–æ–¥—ã" min="1" max="20">
                    <input type="text" name="reps" placeholder="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: 10-12)">
                </div>
                <div class="form-row">
                    <input type="number" name="rest_seconds" placeholder="–û—Ç–¥—ã—Ö (—Å–µ–∫—É–Ω–¥—ã)" min="0" max="600">
                    <input type="number" name="order" placeholder="–ü–æ—Ä—è–¥–æ–∫" min="0" value="0">
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeAddExerciseModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const token = "{{ token }}";
        const planId = {{ plan.id }};
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞
        async function deletePlan() {
            if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï! –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —É–¥–∞–ª–µ–Ω–∏—é –≤—Å–µ—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) return;
            
            try {
                const response = await fetch(`/api/workout-plans/${planId}`, {
                    method: 'DELETE',
                    headers: {'Authorization': `Bearer ${token}`}
                });
                
                if (response.ok) {
                    alert('–ü–ª–∞–Ω —É–¥–∞–ª–µ–Ω');
                    window.location.href = '/dashboard';
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–ª–∞–Ω–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–ª–∞–Ω–∞');
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (—Ä–∞–±–æ—Ç–∞–µ—Ç - endpoint –µ—Å—Ç—å)
        async function deleteExercise(exerciseId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ?')) return;
            
            try {
                const response = await fetch(`/api/exercises/${exerciseId}`, {
                    method: 'DELETE',
                    headers: {'Authorization': `Bearer ${token}`}
                });
                
                if (response.ok) {
                    alert('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è');
            }
        }
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function showAddExerciseModal() {
            document.getElementById('addExerciseModal').style.display = 'block';
        }
        
        function closeAddExerciseModal() {
            document.getElementById('addExerciseModal').style.display = 'none';
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        document.getElementById('addExerciseForm').onsubmit = async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const exerciseData = {
                name: formData.get('name'),
                description: formData.get('description'),
                sets: formData.get('sets') ? parseInt(formData.get('sets')) : null,
                reps: formData.get('reps') || null,
                rest_seconds: formData.get('rest_seconds') ? parseInt(formData.get('rest_seconds')) : null,
                order: formData.get('order') ? parseInt(formData.get('order')) : 0,
                workout_plan_id: planId
            };
            
            try {
                const response = await fetch('/api/exercises/', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(exerciseData)
                });
                
                if (response.ok) {
                    alert('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
                    closeAddExerciseModal();
                    location.reload();
                } else {
                    const error = await response.json();
                    alert(`–û—à–∏–±–∫–∞: ${error.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è');
            }
        };
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('addExerciseModal');
            if (event.target === modal) {
                closeAddExerciseModal();
            }
        };
    </script>
</body>
</html>